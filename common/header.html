<script type="text/discourse-plugin" version="0.8">

    function parseSettings() {
        return JSON.parse(settings.setup);
    }

    function parseSuffix(tags) {
      if (settings.enable_suffix) {
        let suffixList = settings.suffix.split("|");
        console.log("suffix list: " + suffixList);
        console.log("suffix list type: " + typeof suffixList);
        const intersect = tags.filter((element) => suffixList.some(suffix => element.endsWith(suffix)));
        console.log("intersect: " + intersect);
        return(intersect);
      }
      return [];
    }

    var tagged = false;
    var url = "";

    api.modifyClass("component:topic-category", {
      pluginId: "returnTags",
      didInsertElement: function() {
        this._super();
        if (this.topic.tags.length > 0) {
          console.log("setting: " + !settings.enable_suffix);
          console.log("suffix: " + parseSuffix(this.topic.tags).length);
          if (!settings.enable_suffix || parseSuffix(this.topic.tags).length > 0) {
            const data = parseSettings();
            for (let i=0; i < data.length; i++){
                console.log("tags of this page: " + this.topic.tags);
                console.log("tags in settings being checked:" + data[i]["tags"]);
                if(this.topic.tags.includes(data[i]["tag"])){
                    console.log("we found em boys");
                    tagged = true;
                    url = data[i]["url"];
                    break;
                } else {
                    console.log("no");
                }
            }
          }
        }
      }
    });

  const h = require("virtual-dom").h;

  api.createWidget("custom-button-widget", {
    tagName: "div",

    html() {
      if (tagged) {
        return h("a.btn-default.custom-button", {href: url, title:"MUG Homepage", target: "_blank"}, "MUG Homepage");
      } else {
        return h('div', " ");
      }
      
    }
  });

</script>


<script type="text/x-handlebars" data-template-name="/connectors/topic-category/foobar2">
    {{mount-widget widget="custom-button-widget"}}
</script>